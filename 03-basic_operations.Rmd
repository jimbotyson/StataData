# Some using Stata basics

## Folders

I assume that you have a folder structure like

    Project Folder
    ├── raw data
    ├── scripts
    │   ├── cleanmydata.do
    │   └── modelmydata.do
    ├── documentation
    │   ├── PDFs
    │   └── Word_docs
    └──graphs

Of course, other folder set-ups are possible, so be aware of your own as you follow the rest of this guide. I assume that the path to your project is

`c:\users\jt\Documents\Projects\StataWrangling`

## Exercise

If you do not have a folder for your project (including for this training series project!), create one now with subfolders as above. You do not need to create the two do files in the scripts folder. You can do this in Stata if you know how or using your computers user interface.

## Common File types

You will commonly encounter three types of file specific to Stata

-   The .dta file which is Stata's proprietary data format;
-   The do file which is Stata's scripting files;
-   The .log file which is the file type recording session logs.

## The do file

Let's start off by creating a new do file:

    doedit newdo.do

Clear everything to make sure there's nothing leftover in our environment

    clear all

## Initiating your script

In a new data wrangling script you should

-   start a log;
-   make sure you are in the correct project directory;
-   clear working memory.

So in your new do file add these lines:

    capture log close
    log using "MainProjectName $S_DATE.log", append

or

    cmdlog using "CommandsProjectName $S_DATE.log", append

to log commands only and not output.

Next you should make sure you are in the correct directory. Normally for a data wrangling script, this will be the `raw data` directory for the project by adding a line like

    cd c:\users\jt\Documents\Projects\StataWrangling\raw data\

(you must alter this to point at your folder) and then the line

    clear all

to start with a clear workspace.

## Exercise

Close your the log file or log files you have created and outside of Stata find the files and view the content.

## Dataset

We're using a dataset of examination results from thirty school students.

These data are in in csv format: comma seperated values. Each case or observation is a row with variables in rows seperated by commas.

The Stata `use` command reads in data from Stata format files. Read the main data file:

    use https://www.ucl.ac.uk/~ccaajim/results

When you first read a datafile, you should always

-   `describe` the data;
-   check the codebook.

You can do this for the complete set of variables for simple cases, but you may wish to be selective when you have a lot of variables.

### Data Types

The examination data is quite simple. In your do file add

    describe
    codebook

And run the do file. This first command produces

![The main Stata results screen showing the output of desc](./images/describeoutput1.png)

### Interpretation of `describe` output

This output shows first how many observations there are in your data and how many variables. The table that follows includes some detail about each variable:

**Storage type** There are two basic data types in Stata: *numeric* and *string* data. String data has two subtypes: strL (L for long) variables can store phenominal amounts of character data (2 billion) and str\# (where \# is a number) and have a limit on length of 2045 characters. Numeric data is of one of five types:

| type   | precision | range                            |
|:-------|:----------|:---------------------------------|
| byte   | integer   | -127 to 100                      |
| int    | integer   | -32,767 and 32,740               |
| long   | integer   | -2,147,483,647 and 2,147,483,620 |
| float  | real      | 8 digits of accuracy             |
| double | real      | 16 digits of accuracy            |

Format types are associated with variables - each has a default, which determines how values are displayed, so that regardless of the precision of the type, the number of decimal places and the width in number of characters to be displayed can be fixed. So a format type `%9.0g` is a left justified number of maximum 9 characters in width and with specific decimal precision (although in this case zero means 'just as many as can be displayed for this width).

### Interpretation of codebook

The output of `codebook` shows you the data type of the variables; the range and the numeric unit of measure; the number of unique values in the data; the number of values missing; the mean value for continuous variables; the standard deviation; the percentile values for the 10%, 25%, 50%, 75%, 90% points.

The value of output from `codebook` is enhanced if you have taken care to label variables and values.

## Exercise

What are the types and formats of the variables `maths`, `english`, `history`? Why is `maths` different?

# Detecting and correcting

In the data as you find it, there is an anomalous maths score. We can find this my simple inspection of the data because we have a small data set and few variables. If we had a larger data set with many variables this would be much more difficult. We will write some code to help us in the detection of variables.

In Stata we can use programming functions that return values. Many functions return vales **true** or **false**. There is a function **inrange(variable, min, max)** that returns true if *variable* is less greater than *min* and less than *max*. We negate functions with the operator meaning **not** - *!*.

## Exercise

In your script add the following lines:

    gen anomaly = 0
    replace anomaly = 1 if !inrange(maths,0,50)

Are after you run these lines, are there any anomylous cases in your dataset? How many?

The Stata symbol for or is **\|** sometimes called bar or pipe.

Alter the second line above so that it checks not only `maths` but the `english`, `history` and `avxm` variables as well.

# Selecting variables in operations

We will use the command `list` which displays rows of variable values to illustrate the selection of variables.

With most commands, variables can be included in the *varlist* that follows a command name. So on the command line we can type

    list maths english history

which displays all the values for those three variables. Much of the time this is the only selection of variables you need.

But, there are times when you wish to select a subset of variables for manipulation perhaps for a series of operations. In this case we can use `preserve` and `restore`.

The command `preserve` takes a snapshot of a data set. If we then manipulate or modify the data, we can return to the snapshot state with the command `restore`. You can now use `drop varlist` to remove variables from the workspace or `keep varlist` to specify variables to be kept in the workspace.

Stata has a built in *macro* (Stata speak for a script variable) named **\_all** that contains all the variable names currently in memory.

## Exercise

Add the following lines to your script

        preserve
        keep maths english history
        summarize _all
        restore
        

What is the effect of these lines?

How many variables are in working memory after the `keep` command? How many variables are in working memory after the `restore` command?

## The uses of \_all

The `\_all` macro is obviously useful. but as the exercise shows, it can be more useful combined with `drop` and `keep`. The command `drop varlist` removes variables from the workspace, while `keep varlist` drops all but the named variables.

So, if we want to produce summary statistics for all continuous variables in our data, we can use `keep` followed by the list of names and then calculate the summaries.

## Exercise

Add the following lines to your script

    preserve
    keep maths english history
    tabstat _all, statistics(mean sd var kurt skew)
    restore

Answer these questions:

1.  What is the Skewness of the **mathematics** scores?
2.  Which scores show more variability, **English** or **History**?
3.  Which subject has the lowest mean score?

## Creating a custom variable list

Since many commands take a list of variables to operate on, it can be useful to create a specific list of variables that you can easily refer to repeatedly. We will do this with a Stata `global` macro.

Add the following lines to your script

    global conts maths english history
    summarize $conts

Since in this case we don't drop any variables, we don't `preserve` and `restore`.

# Labelling

Variable names are not always very human friendly. It is useful therefor to be able to attach a **label** to a variable, especially for using in output such as graphs.

Add the following line of code to your script

    label variable sex "Gender"

now use the `table` command to view a table of frequencies of the `sex` variable. What has been the effect of your line of code?
